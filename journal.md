# æ—¥å¿—
## 10.1ã€10.2
### ç”¨æˆ·æ³¨å†Œç™»å½•å’Œä¿®æ”¹ä¿¡æ¯çš„api   
- ä½¿ç”¨viperè¯»å–é…ç½®æ–‡ä»¶
- ä½¿ç”¨gormè¿æ¥æ•°æ®åº“
- ä½¿ç”¨ginæ¡†æ¶
- ä½¿ç”¨zapæ—¥å¿—åº“

### é‡åˆ°çš„å¥‡æ€ªbug
åœ¨utilså‡½æ•°é‡Œå†™äº†ä¸€ä¸ªéªŒè¯å¯†ç æ­£ç¡®æ€§çš„å‡½æ•°ï¼Œè°ƒç”¨æ—¶ä¼šå‡ºç°ç©ºæŒ‡é’ˆä½¿ç”¨é”™è¯¯ï¼Œä½†æ˜¯å•ç‹¬çœ‹è¿™ä¸ªå‡½æ•°å¥½åƒå¹¶æ²¡æœ‰é”™è¯¯ï¼Œdebugäº†å¥½ä¹…æš‚æ—¶æ²¡æ‰¾åˆ°åŸå› ã€‚   
~~~go
func PasswordVerify(hashedPwd string, plainPwd string) bool {
	err := bcrypt.CompareHashAndPassword([]byte(hashedPwd), []byte(plainPwd))
	return err == nil
}
~~~

### TODO
å¤´åƒåŠŸèƒ½ã€æ ¡éªŒå¯†ç bugè§£å†³ã€é‚®ä»¶åŠŸèƒ½

### æ€»ç»“
1. ç”¨goæœ‰ç‚¹ç”Ÿç–äº†ï¼Œå†™äº†è›®å¤šæŒ‡é’ˆå¼•ç”¨ã€ç©ºæŒ‡é’ˆçš„é”™è¯¯ï¼Œdebugäº†å¥½ä¹…ï¼Œé‚®ä»¶çš„éƒ¨åˆ†è¿˜æ²¡åšï¼Œæƒ³å…ˆæ¨æ¨è¿›åº¦    
2. ç¬¬ä¸€æ¬¡ç”¨viper,zapè¿™äº›åº“ï¼Œè°ƒè¯•äº†ä¸€æ®µæ—¶é—´ï¼Œä½¿ç”¨viperè§£æé…ç½®æ–‡ä»¶ä¸€ç›´æœ‰é—®é¢˜ï¼Œè¿˜æ˜¯åº”è¯¥å…ˆçœ‹æ ·ä¾‹å†å¼€å§‹å†™  


## 10.3
### Debug
1. zapæ—¥å¿—æŒ‡é’ˆåˆå§‹åŒ–å¤§å°å†™å†™é”™äº†ï¼Œå¯¼è‡´å‡ºç°ç©ºæŒ‡é’ˆ    
2. viperé…ç½®æ–‡ä»¶ï¼Œä¸æ˜¯config.goç›¸å¯¹çš„è·¯å¾„ï¼Œè€Œæ˜¯goç¨‹åºè¿è¡Œä½ç½®ç›¸å¯¹çš„è·¯å¾„ï¼Œä¹‹å‰å†™çš„æ˜¯```viper.SetConfigName("config.json")```ï¼Œåº”è¯¥æ˜¯```viper.SetConfigName("config/config.json")```

### è®°å½•
1. æ˜¨å¤©çš„ç™»å½•å’Œè¯»å–é…ç½®bugä¿®å¥½äº†ï¼Œå†™äº†æ›´æ–°ç”¨æˆ·ä¿¡æ¯api,å¤´åƒåŠŸèƒ½     
2. ç»§ç»­äº†è§£OAuth2.0, äº†è§£äº†æµç¨‹ï¼Œå†™äº†ä¸€ä¸ªä¸OAuth2æä¾›å•†è¿›è¡Œäº¤äº’çš„demoï¼Œå¯¹æµç¨‹æ›´ç†Ÿæ‚‰äº†   
3. æ‰¾èµ„æ–™ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªæ­å»ºOAuth2.0çš„ä»“åº“  


## 10.4
### è®°å½•
1. å¼€å§‹åšOAuth2ï¼Œå®šä¹‰æ•°æ®ç±»å‹ã€è·¯ç”±ã€æœåŠ¡å™¨ã€æ•°æ®åº“ç­‰
2. æƒ³çš„æ˜¯å…ˆæŠŠæˆæƒç æ¨¡å¼åŸºæœ¬é€»è¾‘å†™å‡ºæ¥ï¼Œå†ç»“åˆåˆ°ç”¨æˆ·ç®¡ç†apié‡Œ 
3. TODO: 
- ç”³è¯·OAuth2çš„ç”¨æˆ·idåœ¨å“ªä¸ªé˜¶æ®µä¼ é€ï¼Ÿæ”¾åœ¨å“ªä¸ªç»“æ„ä½“é‡Œæ¯”è¾ƒå¥½
- ç»§ç»­å®Œå–„è·¯ç”±

## 10.5
### è®°å½•
1. é€»è¾‘åŸºæœ¬å®Œæˆï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šç»†èŠ‚æ²¡å¤„ç†ï¼Œæ¯”å¦‚scope,state,tokençš„è¿‡æœŸæ—¶é—´ç­‰
2. æµ‹è¯•å·²ç»å®Œæˆçš„é€»è¾‘



### TODO
- scope,state,tokençš„è¿‡æœŸæ—¶é—´ç­‰
- ç»†èŠ‚è¡¥å……ï¼šredirect_urlæ ¡éªŒï¼Œerrorå’Œerror_descriptionç­‰çš„å¤„ç†ç¬¦åˆæ–‡æ¡£
- æ˜¯å¦å¯ä»¥åˆ©ç”¨response_type=tokenæˆ–è€…codeæ¥å®ç°ä»£ç å¤ç”¨ï¼Ÿ
- ç°åœ¨åšçš„oauth2æ˜¯ä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„ï¼Œä¾¿äºæµ‹è¯•ï¼Œåç»­éœ€è¦æŠŠå®ƒç»“åˆåˆ°ä¹‹å‰å†™çš„ç”¨æˆ·ç®¡ç†apié‡Œ

## 10.6
### è®°å½•
1. è¡¥å……å®Œæˆäº†scope,state,tokençš„è¿‡æœŸæ—¶é—´,redirect_urlæ ¡éªŒç­‰       
2. äº†è§£OIDC & OAuth2ï¼Œåˆçœ‹äº†ä¸€äº›OAuth2æ–‡æ¡£çš„ç»†èŠ‚ï¼Œå‘ç°è‡ªå·±ä¹‹å‰å®ç°çš„è¿˜ä¸è§„èŒƒã€‚     
[fron youtube](https://www.youtube.com/watch?v=t18YB3xDfXI)
3. ç‹‚å†™å‡æœŸä½œä¸šå’ŒæŠ¥å‘Šing


## 10.7
### è®°å½•
1.  å®Œæˆé‚®ç®±æ³¨å†ŒéªŒè¯çš„é€»è¾‘ï¼Œpostmanæµ‹è¯•äº†ç”¨æˆ·ç®¡ç†è·¯ç”±ï¼Œä¿®å¥½äº†ä¸Šä¼ å¤´åƒçš„bug        
2. æµ‹è¯•OAuth2çš„è·¯ç”±ï¼Œdebug

### TODO
1. ç­¾å‘tokenæ—¶åº”è¯¥æŠŠtokenæ‰€å±çš„ç”¨æˆ·idä¹Ÿå­˜è¿›å»ï¼Œè¿™ä¸ªidåº”è¯¥æ˜¯ä»sessionå–å‡ºæˆ–è€…å­˜åœ¨redisä¸­ï¼Œä½†æ˜¯æˆ‘çš„ç”¨æˆ·ç®¡ç†æ²¡æœ‰åšsessionï¼Œæ‰€ä»¥è¯·æ±‚apiè¿˜ä¸å¯è¡Œ      
2. æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸæ²¡æœ‰åš       
3. ç”¨æˆ·ç®¡ç†ï¼šç™»å‡ºå’Œä¼šè¯ç®¡ç†
4. OIDCï¼Œç”ŸæˆOPENIDæ ‡è¯†ç¬¦ï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜è¿›jwtï¼Œè¿”å›æ—¶è¿”å›idtoken    
5. ä»£ç æ¨¡å—åŒ–åšçš„ä¸å¥½ï¼Œå¤ç”¨æ€§å·®ï¼Œéœ€è¦ç‹ ç‹ é‡æ„   
6. revoke token    

### debugè®°å½•
1. æ³¨å†Œè´¦æˆ·æ—¶ï¼Œæ˜æ˜å·²ç»å†™äº†æ£€æŸ¥æ˜¯å¦å·²ç»æ³¨å†Œçš„é€»è¾‘ï¼Œä½†æ˜¯æµ‹è¯•æ—¶å‘ç°è¿˜æ˜¯å¯ä»¥é‡å¤æ³¨å†Œï¼Œä»£ç å¦‚ä¸‹ï¼š     
~~~go
var user *model.User
	var err error
	// æ£€æŸ¥é‚®ç®±æ˜¯å¦å­˜åœ¨
	result := DB.Model(&model.User{}).Where("email = ?", userReq.Email).First(user)
	if result.RowsAffected > 0 {
		return nil, errors.New("already exist")
	}
~~~
ğŸ˜“useræ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œæ‰€ä»¥RowsAffectedä¸€ç›´æ˜¯0ï¼Œå¯¼è‡´æ£€æŸ¥é‚®ç®±æ˜¯å¦å­˜åœ¨çš„é€»è¾‘å¤±æ•ˆã€‚    
2. shouldbindç”¨äºè¯·æ±‚ä½“ï¼Œå¦‚æœè¦ç”¨äºå‚æ•°è¯·ç”¨shouldbindquery
## OAuth2&OIDCç¬”è®°
### OAuth2
#### æ¦‚å¿µ
- client  ç”³è¯·è®¿é—®èµ„æºçš„åº”ç”¨
- resource owner èµ„æºæ‰€æœ‰è€…
- resource server èµ„æºæœåŠ¡å™¨
- authorization server è®¤è¯æœåŠ¡å™¨

#### Authorization Code Flow 
1. clientå‘authorization serverç”³è¯·æˆæƒç        
2. authorization serverè¦æ±‚ç”¨æˆ·ç™»å½•ï¼Œå‘resource ownerè¯¢é—®æ˜¯å¦æˆæƒ      
3. resource owneråŒæ„æˆæƒï¼Œauthorization serverå‘clientå‘é€æˆæƒç authorization code     
4. clientå‘authorization serverå‘é€æˆæƒç authorization codeï¼Œç”³è¯·access token  
5. authorization serveréªŒè¯æˆæƒç authorization codeï¼ŒéªŒè¯é€šè¿‡åå‘clientå‘é€access token    
6. clientè®¿é—®resource serverçš„apiå‘é€access tokenï¼Œç”³è¯·èµ„æº,ï¼ˆåœ¨scopeèŒƒå›´å†…çš„æƒé™ï¼‰      

### OIDC
#### Authentication VS Authorization 
OIDCåŸºäºOAuth2ï¼Œå¯ä»¥å®ç°authenticationã€‚åœ¨OAuth2ä¸­ï¼Œclientå¹¶ä¸çŸ¥é“resource ownerçš„èº«ä»½ï¼Œåªæ˜¯æœ‰å¾—åˆ°æˆæƒã€‚è€Œåœ¨OIDCä¸­ï¼Œclientå¯ä»¥é€šè¿‡serverå‘æ¥çš„IdToken(jwtæ ¼å¼)è§£æjwtå¾—åˆ°resource ownerçš„èº«ä»½ä¿¡æ¯ã€‚
